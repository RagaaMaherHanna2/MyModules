<p-card styleClass="title-card">
  <div class="flex-between">
    <h3 i18n>Product Details</h3>
    <div class="buttons-wrapper" *ngIf="hasPullPermission">
      <button
        pButton
        label="Pull Codes"
        i18n-label
        (click)="show_modal_pull_code()"
      ></button>
    </div>
  </div>
</p-card>
<p-card>
  <ng-container *ngIf="product; else noAvailableProducts">
    <ng-container>
      <div class="flex-wrapper">
        <div class="info-wrapper">
          <div class="two-groups md-col">
            <div class="info-pair">
              <span class="title" i18n>ID</span>
              <span
                class="value"
                style="
                  font-family: 'Courier New', Courier, monospace;
                  font-weight: bold;
                "
                >{{ product.product_details.id }}</span
              >
            </div>
            <div class="info-pair">
              <span class="title" i18n>SKU</span>
              <span class="value">{{ product.product_details.SKU }}</span>
            </div>
          </div>
          <div class="two-groups md-col">
            <div class="info-pair">
              <span class="title" i18n>Product Name [EN]</span>
              <span class="value">{{ product.product_details.name }}</span>
            </div>
            <div class="info-pair">
              <span class="title" i18n>Product Name [AR]</span>
              <span class="value">{{ product.product_details.name_ar }}</span>
            </div>
          </div>
          <div class="two-groups md-col">
            <div class="info-pair">
              <span class="title" i18n>Product Type</span>
              <span class="value"
                >{{ getProdutType(product) }} -
                <span
                  *ngIf="product.product_details.serials_auto_generated"
                  class="font-weight-bold"
                  i18n
                  >Auto generated By Skarla</span
                >
                <span
                  *ngIf="!product.product_details.serials_auto_generated"
                  class="font-weight-bold"
                  i18n
                  >Uploaded By Excel</span
                >
              </span>
            </div>

            <div class="info-pair">
              <span
                *ngIf="product.product_details.is_prepaid"
                class="title"
                i18n
                >Value</span
              >
              <span *ngIf="product.product_details.is_prepaid" class="value">{{
                product.product_details.value
              }}</span>
            </div>
          </div>
          <div
            class="two-groups md-col"
            *ngIf="
              product.product_details.product_specific_attribute === 'topup'
            "
          >
            <div class="info-pair">
              <span class="title" i18n>Product Amount</span>
              <span class="value" i18n>{{
                product.product_details.product_amount
              }}</span>
            </div>

            <div class="info-pair">
              <span class="title" i18n>Product Currency</span>
              <span class="value">{{
                product.product_details.product_currency.symbol
              }}</span>
            </div>
          </div>
          <!-- foodics -->
          <div
            *ngIf="
              product.product_details.foodics_discount_type === '1' ||
              product.product_details.foodics_discount_type === '2'
            "
          >
            <p-divider></p-divider>
            <div class="two-groups">
              <div class="info-pair">
                <span class="title" i18n>Discount Amount</span>
                <span class="value">{{
                  product.product_details.foodics_discount_amount
                }}</span>
              </div>
              <div class="info-pair">
                <span class="title" i18n>Discount Type</span>
                <span class="value">{{
                  getFoodicsDiscountType(
                    product.product_details.foodics_discount_type
                  )
                }}</span>
              </div>
            </div>
            <div class="two-groups">
              <div class="info-pair">
                <span class="title" i18n>Business Reference</span>
                <span class="value">{{
                  product.product_details.foodics_business_reference
                }}</span>
              </div>
              <div class="info-pair">
                <span class="title" i18n>Max Discount Amount</span>
                <span class="value">{{
                  product.product_details.foodics_max_discount_amount
                }}</span>
              </div>
            </div>
            <div class="two-groups">
              <div class="info-pair">
                <span class="title" i18n>Is percentage</span>
                <span class="value">{{
                  product.product_details.foodics_is_percent
                }}</span>
              </div>
              <div class="info-pair">
                <span class="title" i18n>Is include modifiers</span>
                <span class="value">{{
                  product.product_details.foodics_include_modifiers
                }}</span>
              </div>
            </div>
            <div class="info-pair">
              <span class="title" i18n>Is discount taxable </span>
              <span class="value">{{
                product.product_details.foodics_is_discount_taxable
              }}</span>
            </div>
          </div>
          <p-divider></p-divider>
          <div class="two-groups md-col">
            <div class="info-pair">
              <span class="title" i18n>Code Price</span>
              <span class="value">
                {{ product.price | currency : userCurrency }}
              </span>
            </div>
            <div class="info-pair">
              <span class="title" i18n>Limit</span>
              <ng-container *ngIf="product.unlimited; else limit">
                <span class="value" i18n>Unlimited</span>
              </ng-container>
              <ng-template #limit>
                <span class="value"
                  >{{ product.limit }} <span i18n>Code</span></span
                >
              </ng-template>
            </div>
          </div>
          <div class="two-groups md-col">
            <div class="info-pair">
              <span class="title" i18n>Tax</span>
              <p class="value" *ngIf="product?.tax_id?.amount_type; else noTax">
                {{
                  product.tax_id.name +
                    " (" +
                    product.tax_id.amount +
                    generatePerfix(product.tax_id.amount_type) +
                    ")"
                }}
              </p>
              <ng-template #noTax>
                <p class="value" i18n>No Tax</p>
              </ng-template>
            </div>
            <div
              class="info-pair"
              *ngIf="
                product.product_details.expiry_period === null &&
                (product.is_prepaid ||
                  (!product.is_prepaid &&
                    product.product_details.serials_auto_generated))
              "
            >
              <span class="title" i18n>Expiry Date</span>
              <span class="value">{{
                product.product_details.expiry_date | date : "fullDate"
              }}</span>
            </div>
            <div
              class="info-pair"
              *ngIf="
                product.product_details.expiry_date === null &&
                (product.is_prepaid ||
                  (!product.is_prepaid &&
                    product.product_details.serials_auto_generated))
              "
            >
              <span class="title" i18n>Expiry period in days</span>
              <span class="value">{{
                getProductExpiryPeriodValue(
                  product.product_details.expiry_period
                )
              }}</span>
            </div>
            <div
              class="info-pair"
              *ngIf="
                product.product_details.expiry_date !== null &&
                (product.is_prepaid ||
                  (!product.is_prepaid &&
                    product.product_details.serials_auto_generated))
              "
            >
              <span class="title" i18n>Expiry Date</span>
              <span class="value">{{
                product.product_details.expiry_date | date : "fullDate"
              }}</span>
            </div>
            <div
              class="info-pair"
              *ngIf="
                !product.is_prepaid &&
                !product.product_details.serials_auto_generated
              "
            ></div>
          </div>
          <div class="two-groups md-col">
            <div class="info-pair">
              <span class="title" i18n>Pulled Codes</span>
              <span class="value">
                {{ product.pulled_serials_count | number : "1.0-2" }}
                <span i18n>Code</span>
              </span>
            </div>
            <div class="info-pair">
              <span class="title" i18n>Remaining Codes</span>
              <ng-container *ngIf="product.unlimited; else noLimit">
                <span class="value" i18n>Unlimited</span>
              </ng-container>
              <ng-template #noLimit>
                <span class="value">
                  {{ product.remaining_qty }} <span i18n>Code</span>
                </span>
              </ng-template>
            </div>
          </div>

          <p-divider></p-divider>
          <div class="info-pair">
            <span class="title" i18n>How To Use [EN]</span>
            <a class="value">{{ product.product_details.how_to_use }}</a>
          </div>
          <div class="info-pair">
            <span class="title" i18n>How To Use [AR]</span>
            <a class="value">{{ product.product_details.how_to_use_ar }}</a>
          </div>
          <div class="info-pair">
            <span class="title" i18n>Direct Redeem Link</span>
            <a class="value">{{
              product.product_details.direct_redeem_link
            }}</a>
          </div>
        </div>

        <div class="image-wrapper">
          <img [src]="product.product_details.image" [alt]="product.product" />
        </div>
      </div>
    </ng-container>
  </ng-container>
  <ng-template #noAvailableProducts></ng-template>
</p-card>
<p-dialog
  *ngIf="product"
  position="top"
  [(visible)]="showPullCodeModal"
  [style]="{ width: 'min(30rem, 90%)' }"
>
  <form [formGroup]="pullCodeMerchantForm">
    <h4 i18n>Pull Codes</h4>
    <div class="column-label-input">
      <label htmlFor="merchant" i18n class="required-label"
        >Quantity To pull</label
      >
      <input
        formControlName="quantity"
        id="quantity"
        pInputText
        type="number"
        placeholder="Quantity To Pull"
        i18n-placeholder
      />
    </div>
    <div class="column-label-input" *ngIf="product.is_prepaid">
      <label htmlFor="merchant" i18n class="required-label">Email</label>
      <input
        formControlName="email"
        id="email"
        pInputText
        placeholder="Email"
        i18n-placeholder
      />
    </div>
    <button
      pButton
      type="submit"
      label="Submit"
      class="submit-button"
      [disabled]="!pullCodeMerchantForm.valid"
      i18n-label
      (click)="submit()"
    ></button>
  </form>
</p-dialog>
